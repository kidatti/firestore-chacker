<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firestore Viewer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Firestore Viewer</h1>
        </header>

        <!-- Firebase設定画面 -->
        <div id="config-section" class="section">
            <div class="config-form">
                <h2>Firebase設定</h2>
                <p class="config-description">
                    Firebase Console の「プロジェクトの設定」→「全般」→「アプリ」から設定をコピーして貼り付けてください
                </p>
                
                <!-- 保存された設定の状態表示 -->
                <div id="saved-config-status" class="saved-config-status hidden">
                    <div class="status-header">
                        <h3>保存された設定</h3>
                        <button id="clear-saved-config-btn" class="btn danger small">保存された設定を削除</button>
                    </div>
                    <div class="saved-config-info">
                        <p><strong>プロジェクトID:</strong> <span id="saved-project-id">-</span></p>
                        <p><strong>Auth Domain:</strong> <span id="saved-auth-domain">-</span></p>
                        <p class="config-note">新しい設定を入力すると上書きされます</p>
                    </div>
                </div>
                
                <div class="config-method-tabs">
                    <button id="json-tab" class="tab-btn active">JSON貼り付け</button>
                    <button id="form-tab" class="tab-btn">個別入力</button>
                </div>
                
                <!-- JSON入力エリア -->
                <div id="json-config" class="config-method">
                    <div class="form-group">
                        <label for="firebase-json">Firebase設定JSON:</label>
                        <div class="json-input-container">
                            <textarea id="firebase-json" rows="12" placeholder="const firebaseConfig = {
  apiKey: 'AIzaSy...',
  authDomain: 'your-project.firebaseapp.com',
  projectId: 'your-project-id',
  storageBucket: 'your-project.firebasestorage.app',
  messagingSenderId: '123456789',
  appId: '1:123:web:abc'
};"></textarea>
                            <div id="json-validation-status" class="json-validation-status"></div>
                        </div>
                        <div id="json-error" class="json-error-message"></div>
                    </div>
                    <div class="json-help">
                        <p><strong>使い方:</strong></p>
                        <ul>
                            <li>Firebase Console からコピーした設定をそのまま貼り付け</li>
                            <li><code>const firebaseConfig = {...}</code> 形式でも <code>{...}</code> JSON形式でもOK</li>
                            <li>自動で解析して設定を抽出します</li>
                        </ul>
                    </div>
                </div>
                
                <!-- 個別入力エリア -->
                <div id="form-config" class="config-method hidden">
                    <div class="form-group">
                        <label for="api-key">API Key:</label>
                        <input type="text" id="api-key" placeholder="AIzaSy...">
                    </div>
                    
                    <div class="form-group">
                        <label for="auth-domain">Auth Domain:</label>
                        <input type="text" id="auth-domain" placeholder="your-project.firebaseapp.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="project-id">Project ID:</label>
                        <input type="text" id="project-id" placeholder="your-project-id">
                    </div>
                    
                    <div class="form-group">
                        <label for="storage-bucket">Storage Bucket:</label>
                        <input type="text" id="storage-bucket" placeholder="your-project.firebasestorage.app">
                    </div>
                    
                    <div class="form-group">
                        <label for="messaging-sender-id">Messaging Sender ID:</label>
                        <input type="text" id="messaging-sender-id" placeholder="123456789">
                    </div>
                    
                    <div class="form-group">
                        <label for="app-id">App ID:</label>
                        <input type="text" id="app-id" placeholder="1:123:web:abc">
                    </div>
                </div>
                
                <div class="config-actions">
                    <button id="save-config-btn" class="btn primary">設定を保存</button>
                    <button id="clear-config-btn" class="btn secondary">設定をクリア</button>
                </div>
                
                <div class="config-help">
                    <details>
                        <summary>設定の取得方法</summary>
                        <div class="help-content">
                            <ol>
                                <li>Firebase Console (console.firebase.google.com) にアクセス</li>
                                <li>プロジェクトを選択</li>
                                <li>「プロジェクトの設定」（歯車アイコン）をクリック</li>
                                <li>「全般」タブの「アプリ」セクションを確認</li>
                                <li>Web アプリの設定をコピーして上記フォームに入力</li>
                            </ol>
                        </div>
                    </details>
                </div>
                
                <div id="config-error" class="error-message"></div>
            </div>
        </div>

        <!-- ログイン画面 -->
        <div id="login-section" class="section hidden">
            <div class="login-form">
                <h2>ログイン</h2>
                <div class="form-group">
                    <label for="email">メールアドレス:</label>
                    <input type="email" id="email" placeholder="メールアドレスを入力">
                </div>
                <div class="form-group">
                    <label for="password">パスワード:</label>
                    <input type="password" id="password" placeholder="パスワードを入力">
                </div>
                <div class="button-group">
                    <button id="login-btn" class="btn primary">ログイン</button>
                </div>
                
                <div class="divider">
                    <span>または</span>
                </div>
                
                <div class="google-login">
                    <button id="google-login-btn" class="btn google">
                        <svg width="20" height="20" viewBox="0 0 24 24" class="google-icon">
                            <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Googleでログイン
                    </button>
                </div>
                <div id="auth-error" class="error-message"></div>
                
                <div class="config-change-section">
                    <button id="change-config-btn" class="btn secondary small">設定を変更</button>
                </div>
            </div>
        </div>

        <!-- メイン画面 -->
        <div id="main-section" class="section hidden">
            <div class="user-info">
                <span id="user-email"></span>
                <div class="user-actions">
                    <button id="change-config-main-btn" class="btn secondary small">設定変更</button>
                    <button id="logout-btn" class="btn secondary">ログアウト</button>
                    <button id="logout-clear-config-btn" class="btn danger">ログアウト & 設定消去</button>
                </div>
            </div>

            <div class="data-section">
                <h2>Firestore Data</h2>
                
                <!-- コレクション一覧 -->
                <div class="collections-section">
                    <div class="section-header">
                        <h3>Available Collections</h3>
                        <button id="load-collections-btn" class="btn secondary small">Refresh</button>
                    </div>
                    <div id="collections-list" class="collections-list">
                        <div class="loading-collections">Loading collections...</div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="form-group">
                        <label for="collection-name">Collection Name:</label>
                        <input type="text" id="collection-name" placeholder="Enter collection name" value="users">
                    </div>
                    <button id="load-data-btn" class="btn primary">Load Data</button>
                </div>
                
                <div id="loading" class="loading hidden">Loading data...</div>
                <div id="data-error" class="error-message"></div>
                
                <div id="data-display" class="data-display">
                    <div id="data-count" class="data-count"></div>
                    <div id="data-content" class="data-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    
    <!-- アプリケーションスクリプト -->
    <script type="module" src="app.js"></script>
</body>
</html>